#!/usr/bin/env bash
# This script configures Nginx to listen on port 80 of all the server's active IPv4 IPs.

# Check if Nginx is installed
if ! command -v nginx &> /dev/null; then
    echo "Nginx is not installed. Installing..."
    apt-get update
    apt-get install -y nginx
fi

# Backup the default Nginx configuration
cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup

# Create a new Nginx configuration
cat <<EOL > /etc/nginx/nginx.conf
user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 768;
}

http {
    server {
        listen 80;
        listen [::]:80 ipv6only=off;

        server_name _;

        root /var/www/html;
        index index.html;

        location / {
            try_files \$uri \$uri/ =404;
        }
    }
}
EOL

# Restart Nginx
systemctl restart nginx

echo "Nginx has been configured to listen on port 80 of all active IPv4 IPs."
